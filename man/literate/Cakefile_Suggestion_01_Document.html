<!DOCTYPE html><html lang="en"><head><title>Cakefile_Suggestion_01_Document</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="Cakefile_Suggestion_01_Document"><meta name="groc-project-path" content="Cakefile_Suggestion_01_Document.coffee"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">Cakefile_Suggestion_01_Document.coffee</div></div><div id="document"><div class="segment"></div><div class="segment"><div class="comments"><div class="wrapper"><h1 id="suggestions">Suggestions</h1></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Context: DocPad source compilation, building, publishing.</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p><strong>Purpose:</strong> Add additional code to support publishing source code comments
and markup as documentation in HTML by using one, or several of tools
available. This allows for a bare source code file, and renamed variant file
names to support multiple views on the source.</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="constants">Constants</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p><strong>Suggestion:</strong> Additional documentation publishing directory as 'constant'
variable on top of the currently available ones.</p></div></div><div class="code"><div class="wrapper"><span class="nv">WINDOWS = </span><span class="nx">process</span><span class="p">.</span><span class="nx">platform</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="mi">0</span>
<span class="nv">NODE    = </span><span class="nx">process</span><span class="p">.</span><span class="nx">execPath</span>
<span class="nv">NPM     = </span><span class="k">if</span> <span class="nx">WINDOWS</span> <span class="k">then</span> <span class="nx">process</span><span class="p">.</span><span class="nx">execPath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s">&#39;node.exe&#39;</span><span class="p">,</span><span class="s">&#39;npm.cmd&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;npm&#39;</span>
<span class="nv">EXT     = </span><span class="p">(</span><span class="k">if</span> <span class="nx">WINDOWS</span> <span class="k">then</span> <span class="s">&#39;.cmd&#39;</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="nv">APP     = </span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()</span>
<span class="nv">BIN     = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">APP</span><span class="si">}</span><span class="s">/node_modules/.bin&quot;</span>
<span class="nv">CAKE    = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">BIN</span><span class="si">}</span><span class="s">/cake</span><span class="si">#{</span><span class="nx">EXT</span><span class="si">}</span><span class="s">&quot;</span>
<span class="nv">COFFEE  = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">BIN</span><span class="si">}</span><span class="s">/coffee</span><span class="si">#{</span><span class="nx">EXT</span><span class="si">}</span><span class="s">&quot;</span>
<span class="nv">OUT     = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">APP</span><span class="si">}</span><span class="s">/out&quot;</span>
<span class="nv">SRC     = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">APP</span><span class="si">}</span><span class="s">/src&quot;</span>
<span class="nv">TEST    = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">APP</span><span class="si">}</span><span class="s">/test&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>e.g. root documentation path =></p></div></div><div class="code"><div class="wrapper"><span class="nv">DOC     = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">APP</span><span class="si">}</span><span class="s">/man&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>e.g. literate documentation tool =></p></div></div><div class="code"><div class="wrapper"><span class="nv">GROC    = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">BIN</span><span class="si">}</span><span class="s">/groc</span><span class="si">#{</span><span class="nx">EXT</span><span class="si">}</span><span class="s">&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>e.g. object-oriented documentation tool =></p></div></div><div class="code"><div class="wrapper"><span class="nv">CROJS   = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">BIN</span><span class="si">}</span><span class="s">/crojsdoc</span><span class="si">#{</span><span class="nx">EXT</span><span class="si">}</span><span class="s">&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="dependencies">Dependencies</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p><strong>No changes in Cakefile dependencies</strong></p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>We do add to packages.json the documentation tools <code>groc</code> and <code>crojsdoc</code>
devDependencies.</p>

<pre><code>"groc": "~0.3.2",
"crojsdoc": "~0.4.0"
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nv">pathUtil = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">)</span>
<span class="p">{</span><span class="nx">exec</span><span class="p">,</span><span class="nx">spawn</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s">&#39;child_process&#39;</span><span class="p">)</span>

<span class="nv">safe = </span><span class="nf">(next,fn) -&gt;</span>
  <span class="k">return</span> <span class="nf">(err) -&gt;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">err</span>
    <span class="k">return</span> <span class="nx">fn</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="actions">Actions</h2></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Asynchronous functions, names as verbs</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p><strong>Suggestion:</strong> Additional path addition for documentation on the action to
clean, we remove all</p></div></div><div class="code"><div class="wrapper"><span class="nv">clean = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nv">args = </span><span class="p">[</span>
    <span class="s">&#39;-Rf&#39;</span>
    <span class="nx">OUT</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>e.g. delete full dir =></p></div></div><div class="code"><div class="wrapper">    <span class="nx">DOC</span>

    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">APP</span><span class="p">,</span><span class="s">&#39;node_modules&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">APP</span><span class="p">,</span><span class="s">&#39;*out&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">APP</span><span class="p">,</span><span class="s">&#39;*log&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">TEST</span><span class="p">,</span><span class="s">&#39;node_modules&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">TEST</span><span class="p">,</span><span class="s">&#39;*out&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">TEST</span><span class="p">,</span><span class="s">&#39;*log&#39;</span><span class="p">)</span>
  <span class="p">]</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="s">&#39;rm&#39;</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>

<span class="nv">compile = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="nx">COFFEE</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;-bco&#39;</span><span class="p">,</span> <span class="nx">OUT</span><span class="p">,</span> <span class="nx">SRC</span><span class="p">],</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>

<span class="nv">watch = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="nx">COFFEE</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;-bwco&#39;</span><span class="p">,</span> <span class="nx">OUT</span><span class="p">,</span> <span class="nx">SRC</span><span class="p">],</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>

<span class="nv">install = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="nx">NPM</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;install&#39;</span><span class="p">],</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">}).</span><span class="nx">on</span> <span class="s">&#39;exit&#39;</span><span class="p">,</span> <span class="nx">safe</span> <span class="nx">next</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="nx">spawn</span><span class="p">(</span><span class="nx">NPM</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;install&#39;</span><span class="p">],</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">TEST</span><span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>

<span class="nv">reset = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">clean</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">safe</span> <span class="nx">next</span><span class="p">,</span> <span class="nf">-&gt;</span> <span class="nx">install</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">safe</span> <span class="nx">next</span><span class="p">,</span> <span class="nf">-&gt;</span> <span class="nx">compile</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">next</span>

<span class="nv">setup = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">install</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">safe</span> <span class="nx">next</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="nx">compile</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">next</span>

<span class="nv">test = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nv">args = </span><span class="p">[]</span>
  <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s">&quot;--debug-brk&quot;</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">debug</span>
  <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">OUT</span><span class="si">}</span><span class="s">/test/everything.test.js&quot;</span><span class="p">)</span>
  <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s">&quot;--joe-reporter=list&quot;</span><span class="p">)</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="nx">NODE</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">},</span> <span class="nx">next</span><span class="p">)</span>

<span class="nv">finish = </span><span class="nf">(err) -&gt;</span>
  <span class="k">throw</span> <span class="nx">err</span>  <span class="k">if</span> <span class="nx">err</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;OK&#39;</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p><strong>Suggestion:</strong> Additional action to use for publishing source documentation,
this allows using boolean flags to choose between tools/styles of documentation
and publishing.</p></div></div><div class="code"><div class="wrapper"><span class="nb">document</span> <span class="o">=</span> <span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>We are using <code>.groc.json</code> for our configuration of the literate documentation tool
Optionally you can enter arguments here</p></div></div><div class="code"><div class="wrapper">  <span class="nv">args = </span><span class="p">[]</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Spawn literate tool if so desired</p></div></div><div class="code"><div class="wrapper">  <span class="nx">spawn</span><span class="p">(</span><span class="nx">GROC</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="p">{</span> <span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">},</span> <span class="nx">next</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">literate</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Or the object-oriented API documentation using @tags</p></div></div><div class="code"><div class="wrapper">  <span class="nx">spawn</span><span class="p">(</span><span class="nx">CROJS</span><span class="p">,</span> <span class="s">&quot;-o </span><span class="si">#{</span><span class="nx">DOC</span><span class="si">}</span><span class="s">/crojs&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">oop</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="commands">Commands</h2>

<p>Cake tasks, names as verbs that call Actions
These act as as single argumentless sub-commands which means 1 for each variety.</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;clean&#39;</span><span class="p">,</span> <span class="s">&#39;clean up instance&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">clean</span> <span class="nx">finish</span>

<span class="nx">task</span> <span class="s">&#39;compile&#39;</span><span class="p">,</span> <span class="s">&#39;compile our files&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">compile</span> <span class="nx">finish</span>

<span class="nx">task</span> <span class="s">&#39;dev&#39;</span><span class="p">,</span> <span class="s">&#39;watch and recompile our files&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">watch</span> <span class="nx">finish</span>

<span class="nx">task</span> <span class="s">&#39;watch&#39;</span><span class="p">,</span> <span class="s">&#39;watch and recompile our files&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">watch</span> <span class="nx">finish</span>

<span class="nx">task</span> <span class="s">&#39;install&#39;</span><span class="p">,</span> <span class="s">&#39;install dependencies&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">install</span> <span class="nx">finish</span>

<span class="nx">task</span> <span class="s">&#39;reset&#39;</span><span class="p">,</span> <span class="s">&#39;reset instance&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">reset</span> <span class="nx">finish</span>

<span class="nx">task</span> <span class="s">&#39;setup&#39;</span><span class="p">,</span> <span class="s">&#39;setup for development&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">setup</span> <span class="nx">finish</span>

<span class="nx">task</span> <span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="s">&#39;run our tests&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">test</span> <span class="nx">finish</span>

<span class="nx">task</span> <span class="s">&#39;test-debug&#39;</span><span class="p">,</span> <span class="s">&#39;run our tests in debug mode&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">test</span> <span class="p">{</span><span class="nx">debug</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="nx">finish</span>

<span class="nx">task</span> <span class="s">&#39;test-prepare&#39;</span><span class="p">,</span> <span class="s">&#39;prepare out tests&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">setup</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>e.g. literate tool much like Docco but better =></p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;document-literate&#39;</span><span class="p">,</span> <span class="s">&#39;*NEW* literate programming documentation from source code&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nb">document</span> <span class="p">{</span><span class="nx">literate</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>e.g. class/object-oriented tool much like JSDoc but better =></p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;document-object&#39;</span><span class="p">,</span> <span class="s">&#39;*NEW* object-oriented / API documentation from source code&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nb">document</span> <span class="p">{</span><span class="nx">oop</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="nx">finish</span></div></div></div></div></body></html>