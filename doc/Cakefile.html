<!DOCTYPE html><html lang="en"><head><title>Cakefile</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="Cakefile"><meta name="groc-project-path" content="Cakefile"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">Cakefile</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><p>This file was originally created by Benjamin Lupton <a href="&#109;&#x61;&#x69;&#108;&#116;&#111;:&#x62;&#64;&#x6c;&#117;&#x70;&#x74;&#111;&#x6e;&#x2e;&#99;&#x63;">&#x62;&#64;&#x6c;&#117;&#x70;&#x74;&#111;&#x6e;&#x2e;&#99;&#x63;</a>
(http://balupton.com) and is currently licensed under the Creative Commons
Zero (http://creativecommons.org/publicdomain/zero/1.0/) making it public
domain so you can do whatever you wish with it without worry (you can even
remove this notice!)</p></div></div><div class="code"><div class="wrapper"><span class="c1">#</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>If you change something here, be sure to reflect the changes in:
- the scripts section of the package.json file
- the .travis.yml file</p></div></div><div class="code"><div class="wrapper"><span class="nv">WINDOWS = </span><span class="nx">process</span><span class="p">.</span><span class="nx">platform</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="mi">0</span>
<span class="nv">NODE    = </span><span class="nx">process</span><span class="p">.</span><span class="nx">execPath</span>
<span class="nv">NPM     = </span><span class="k">if</span> <span class="nx">WINDOWS</span> <span class="k">then</span> <span class="nx">process</span><span class="p">.</span><span class="nx">execPath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s">&#39;node.exe&#39;</span><span class="p">,</span><span class="s">&#39;npm.cmd&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;npm&#39;</span>
<span class="nv">EXT     = </span><span class="p">(</span><span class="k">if</span> <span class="nx">WINDOWS</span> <span class="k">then</span> <span class="s">&#39;.cmd&#39;</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="nv">APP     = </span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()</span>
<span class="nv">BIN     = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">APP</span><span class="si">}</span><span class="s">/node_modules/.bin&quot;</span>
<span class="nv">CAKE    = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">BIN</span><span class="si">}</span><span class="s">/cake</span><span class="si">#{</span><span class="nx">EXT</span><span class="si">}</span><span class="s">&quot;</span>
<span class="nv">COFFEE  = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">BIN</span><span class="si">}</span><span class="s">/coffee</span><span class="si">#{</span><span class="nx">EXT</span><span class="si">}</span><span class="s">&quot;</span>
<span class="nv">OUT     = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">APP</span><span class="si">}</span><span class="s">/out&quot;</span>
<span class="nv">SRC     = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">APP</span><span class="si">}</span><span class="s">/src&quot;</span>
<span class="nv">TEST    = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">APP</span><span class="si">}</span><span class="s">/test&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><hr />

<p>Requires</p></div></div><div class="code"><div class="wrapper"><span class="nv">pathUtil = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">)</span>
<span class="p">{</span><span class="nx">exec</span><span class="p">,</span><span class="nx">spawn</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s">&#39;child_process&#39;</span><span class="p">)</span>
<span class="nv">safe = </span><span class="nf">(next,fn) -&gt;</span>
  <span class="k">return</span> <span class="nf">(err) -&gt;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">err</span>
    <span class="k">return</span> <span class="nx">fn</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><hr />

<p>Actions</p></div></div><div class="code"><div class="wrapper"><span class="nv">clean = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nv">args = </span><span class="p">[</span>
    <span class="s">&#39;-Rf&#39;</span>
    <span class="nx">OUT</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">APP</span><span class="p">,</span><span class="s">&#39;node_modules&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">APP</span><span class="p">,</span><span class="s">&#39;*out&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">APP</span><span class="p">,</span><span class="s">&#39;*log&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">TEST</span><span class="p">,</span><span class="s">&#39;node_modules&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">TEST</span><span class="p">,</span><span class="s">&#39;*out&#39;</span><span class="p">)</span>
    <span class="nx">pathUtil</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">TEST</span><span class="p">,</span><span class="s">&#39;*log&#39;</span><span class="p">)</span>
  <span class="p">]</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="s">&#39;rm&#39;</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>

<span class="nv">compile = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="nx">COFFEE</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;-bco&#39;</span><span class="p">,</span> <span class="nx">OUT</span><span class="p">,</span> <span class="nx">SRC</span><span class="p">],</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>

<span class="nv">watch = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="nx">COFFEE</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;-bwco&#39;</span><span class="p">,</span> <span class="nx">OUT</span><span class="p">,</span> <span class="nx">SRC</span><span class="p">],</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>

<span class="nv">install = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="nx">NPM</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;install&#39;</span><span class="p">],</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">}).</span><span class="nx">on</span> <span class="s">&#39;exit&#39;</span><span class="p">,</span> <span class="nx">safe</span> <span class="nx">next</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="nx">spawn</span><span class="p">(</span><span class="nx">NPM</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;install&#39;</span><span class="p">],</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">TEST</span><span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>

<span class="nv">reset = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">clean</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">safe</span> <span class="nx">next</span><span class="p">,</span> <span class="nf">-&gt;</span> <span class="nx">install</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">safe</span> <span class="nx">next</span><span class="p">,</span> <span class="nf">-&gt;</span> <span class="nx">compile</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">next</span>

<span class="nv">setup = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nx">install</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">safe</span> <span class="nx">next</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="nx">compile</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">next</span>

<span class="nv">test = </span><span class="nf">(opts,next) -&gt;</span>
  <span class="p">(</span><span class="nv">next = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{})</span>  <span class="k">unless</span> <span class="nx">next</span><span class="o">?</span>
  <span class="nv">args = </span><span class="p">[]</span>
  <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s">&quot;--debug-brk&quot;</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">debug</span>
  <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">OUT</span><span class="si">}</span><span class="s">/test/everything.test.js&quot;</span><span class="p">)</span>
  <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s">&quot;--joe-reporter=list&quot;</span><span class="p">)</span>
  <span class="nx">spawn</span><span class="p">(</span><span class="nx">NODE</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="p">{</span><span class="nx">stdio</span><span class="o">:</span><span class="s">&#39;inherit&#39;</span><span class="p">,</span><span class="nx">cwd</span><span class="o">:</span><span class="nx">APP</span><span class="p">},</span> <span class="nx">next</span><span class="p">)</span>

<span class="nv">finish = </span><span class="nf">(err) -&gt;</span>
  <span class="k">throw</span> <span class="nx">err</span>  <span class="k">if</span> <span class="nx">err</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;OK&#39;</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><hr />

<p>Commands</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>clean</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;clean&#39;</span><span class="p">,</span> <span class="s">&#39;clean up instance&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">clean</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>compile</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;compile&#39;</span><span class="p">,</span> <span class="s">&#39;compile our files&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">compile</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>dev/watch</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;dev&#39;</span><span class="p">,</span> <span class="s">&#39;watch and recompile our files&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">watch</span> <span class="nx">finish</span>
<span class="nx">task</span> <span class="s">&#39;watch&#39;</span><span class="p">,</span> <span class="s">&#39;watch and recompile our files&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">watch</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>install</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;install&#39;</span><span class="p">,</span> <span class="s">&#39;install dependencies&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">install</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>reset</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;reset&#39;</span><span class="p">,</span> <span class="s">&#39;reset instance&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">reset</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>setup</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;setup&#39;</span><span class="p">,</span> <span class="s">&#39;setup for development&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">setup</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>test</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="s">&#39;run our tests&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">test</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>test-debug</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;test-debug&#39;</span><span class="p">,</span> <span class="s">&#39;run our tests in debug mode&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">test</span> <span class="p">{</span><span class="nx">debug</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span> <span class="nx">finish</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>test-prepare</p></div></div><div class="code"><div class="wrapper"><span class="nx">task</span> <span class="s">&#39;test-prepare&#39;</span><span class="p">,</span> <span class="s">&#39;prepare out tests&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
  <span class="nx">setup</span> <span class="nx">finish</span></div></div></div></div></body></html>