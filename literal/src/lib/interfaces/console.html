<!DOCTYPE html><html lang="en"><head><title>src/lib/interfaces/console</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../../"><meta name="groc-document-path" content="src/lib/interfaces/console"><meta name="groc-project-path" content="src/lib/interfaces/console.coffee"><link rel="stylesheet" type="text/css" media="all" href="../../../assets/style.css"><script type="text/javascript" src="../../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/lib/interfaces/console.coffee</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><p>Requires</p></div></div><div class="code"><div class="wrapper"><span class="p">{</span><span class="nx">cliColor</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s">&#39;caterpillar&#39;</span><span class="p">)</span>
<span class="nv">pathUtil = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Console Interface</p></div></div><div class="code"><div class="wrapper"><span class="k">class</span> <span class="nx">ConsoleInterface</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Setup the CLI</p></div></div><div class="code"><div class="wrapper">  <span class="nv">constructor: </span><span class="nf">(opts,next) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare</p></div></div><div class="code"><div class="wrapper">    <span class="nv">consoleInterface = </span><span class="nx">@</span>
    <span class="vi">@docpad = </span><span class="nv">docpad = </span><span class="nx">opts</span><span class="p">.</span><span class="nx">docpad</span>
    <span class="vi">@commander = </span><span class="nv">commander = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;commander&#39;</span><span class="p">)</span>
    <span class="nv">locale = </span><span class="nx">docpad</span><span class="p">.</span><span class="nx">getLocale</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Version information</p></div></div><div class="code"><div class="wrapper">    <span class="nv">version = </span><span class="nx">require</span><span class="p">(</span><span class="nx">__dirname</span><span class="o">+</span><span class="s">&#39;/../../../package.json&#39;</span><span class="p">).</span><span class="nx">version</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><hr />

<p>Global config</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">version</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">option</span><span class="p">(</span>
        <span class="s">&#39;-o, --out &lt;outPath&gt;&#39;</span>
        <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleOptionOut</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">option</span><span class="p">(</span>
        <span class="s">&#39;-c, --config &lt;configPath&gt;&#39;</span>
        <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleOptionConfig</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">option</span><span class="p">(</span>
        <span class="s">&#39;-e, --env &lt;environment&gt;&#39;</span>
        <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleOptionEnv</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">option</span><span class="p">(</span>
        <span class="s">&#39;-d, --debug [logLevel]&#39;</span>
        <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleOptionDebug</span>
        <span class="nb">parseInt</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">option</span><span class="p">(</span>
        <span class="s">&#39;-f, --force&#39;</span>
        <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleOptionForce</span>
      <span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><hr />

<p>Commands</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>run</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;run&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionRun</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">option</span><span class="p">(</span>
        <span class="s">&#39;-s, --skeleton &lt;skeleton&gt;&#39;</span>
        <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleOptionSkeleton</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">option</span><span class="p">(</span>
        <span class="s">&#39;-p, --port &lt;port&gt;&#39;</span>
        <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleOptionPort</span>
        <span class="nb">parseInt</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">wrapAction</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">run</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>server</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;server&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionServer</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">option</span><span class="p">(</span>
        <span class="s">&#39;-p, --port &lt;port&gt;&#39;</span>
        <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleOptionPort</span>
        <span class="nb">parseInt</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">wrapAction</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">server</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>skeleton</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;skeleton&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionSkeleton</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">option</span><span class="p">(</span>
        <span class="s">&#39;-s, --skeleton &lt;skeleton&gt;&#39;</span>
        <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleOptionSkeleton</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">wrapAction</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">skeleton</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>render</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;render [path]&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionRender</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span> <span class="nf">(command) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Disable anything uncessary or that could cause extra output we don't want</p></div></div><div class="code"><div class="wrapper">        <span class="nx">commander</span><span class="p">.</span><span class="nx">debug</span> <span class="o">?=</span> <span class="mi">5</span>
        <span class="nv">commander.checkVersion = </span><span class="kc">false</span>
        <span class="nv">commander.welcome = </span><span class="kc">false</span>
        <span class="nv">commander.prompts = </span><span class="kc">false</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Perform the render</p></div></div><div class="code"><div class="wrapper">        <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">performAction</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">render</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>generate</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;generate&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionGenerate</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">wrapAction</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">generate</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>watch</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;watch&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionWatch</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">wrapAction</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">watch</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>install</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;install&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionInstall</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">wrapAction</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">install</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>clean</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;clean&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionClean</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">wrapAction</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">clean</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>info</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;info&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionInfo</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">wrapAction</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">info</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>help</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;help&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionHelp</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">wrapAction</span><span class="p">(</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">help</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>unknown</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span>
      <span class="p">.</span><span class="nx">command</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">description</span><span class="p">(</span><span class="nx">locale</span><span class="p">.</span><span class="nx">consoleDescriptionUnknown</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">action</span> <span class="nf">-&gt;</span>
        <span class="nx">commander</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s">&#39;help&#39;</span><span class="p">,</span> <span class="p">[])</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><hr />

<p>DocPad Listeners</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Welcome</p></div></div><div class="code"><div class="wrapper">    <span class="nx">docpad</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;welcome&#39;</span><span class="p">,</span> <span class="nf">(data,next) -&gt;</span>
      <span class="k">return</span> <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">welcomeCallback</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><hr />

<p>Finish Up</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Plugins</p></div></div><div class="code"><div class="wrapper">    <span class="nx">docpad</span><span class="p">.</span><span class="nx">emitSync</span> <span class="s">&#39;consoleSetup&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">consoleInterface</span><span class="p">,</span><span class="nx">commander</span><span class="p">},</span> <span class="nf">(err) -&gt;</span>
      <span class="k">return</span> <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">err</span>
      <span class="nx">next</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">consoleInterface</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Chain</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>=================================
Helpers</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Start the CLI</p></div></div><div class="code"><div class="wrapper">  <span class="nv">start: </span><span class="nf">(argv) =&gt;</span>
    <span class="nx">@commander</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">argv</span> <span class="o">or</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">)</span>
    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Get the commander</p></div></div><div class="code"><div class="wrapper">  <span class="nv">getCommander: </span><span class="o">=&gt;</span>
    <span class="nx">@commander</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle Error</p></div></div><div class="code"><div class="wrapper">  <span class="nv">handleError: </span><span class="nf">(err) =&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare</p></div></div><div class="code"><div class="wrapper">    <span class="nv">docpad = </span><span class="nx">@docpad</span>
    <span class="nv">locale = </span><span class="nx">docpad</span><span class="p">.</span><span class="nx">getLocale</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle</p></div></div><div class="code"><div class="wrapper">    <span class="nx">docpad</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleError</span><span class="p">)</span>
    <span class="nx">docpad</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Chain</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Wrap Action</p></div></div><div class="code"><div class="wrapper">  <span class="nv">wrapAction: </span><span class="nf">(action) =&gt;</span>
    <span class="nv">consoleInterface = </span><span class="nx">@</span>
    <span class="k">return</span> <span class="nf">(command) -&gt;</span> <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">performAction</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span><span class="nx">action</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Perform Action</p></div></div><div class="code"><div class="wrapper">  <span class="nv">performAction: </span><span class="nf">(command,action) =&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Create</p></div></div><div class="code"><div class="wrapper">    <span class="nv">instanceConfig = </span><span class="nx">@extractConfig</span><span class="p">(</span><span class="nx">command</span><span class="p">)</span>
    <span class="nx">@docpad</span><span class="p">.</span><span class="nx">action</span> <span class="s">&#39;load ready&#39;</span><span class="p">,</span> <span class="nx">instanceConfig</span><span class="p">,</span> <span class="nf">(err) =&gt;</span>
      <span class="k">return</span> <span class="nx">@completeAction</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">err</span>
      <span class="nx">action</span><span class="p">(</span><span class="nx">@completeAction</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Chain</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Complete Action</p></div></div><div class="code"><div class="wrapper">  <span class="nv">completeAction: </span><span class="nf">(err) =&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare</p></div></div><div class="code"><div class="wrapper">    <span class="nv">docpad = </span><span class="nx">@docpad</span>
    <span class="nv">locale = </span><span class="nx">docpad</span><span class="p">.</span><span class="nx">getLocale</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Handle the error</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">err</span>
      <span class="nx">@handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">docpad</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&#39;info&#39;</span><span class="p">,</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">consoleSuccess</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Chain</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Extract Configuration</p></div></div><div class="code"><div class="wrapper">  <span class="nv">extractConfig: </span><span class="nf">(customConfig={}) =&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare</p></div></div><div class="code"><div class="wrapper">    <span class="nv">config = </span><span class="p">{}</span>
    <span class="nv">commanderConfig = </span><span class="nx">@commander</span>
    <span class="nv">sourceConfig = </span><span class="nx">@docpad</span><span class="p">.</span><span class="nx">initialConfig</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>debug -> logLevel</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">commanderConfig</span><span class="p">.</span><span class="nx">debug</span>
      <span class="nv">commanderConfig.debug = </span><span class="mi">7</span>  <span class="k">if</span> <span class="nx">commanderConfig</span><span class="p">.</span><span class="nx">debug</span> <span class="o">is</span> <span class="kc">true</span>
      <span class="nv">commanderConfig.logLevel = </span><span class="nx">commanderConfig</span><span class="p">.</span><span class="nx">debug</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>config -> configPaths</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">commanderConfig</span><span class="p">.</span><span class="nx">config</span>
      <span class="nv">configPath = </span><span class="nx">pathUtil</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span><span class="nx">commanderConfig</span><span class="p">.</span><span class="nx">config</span><span class="p">)</span>
      <span class="nv">commanderConfig.configPaths = </span><span class="p">[</span><span class="nx">configPath</span><span class="p">]</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>out -> outPath</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">commanderConfig</span><span class="p">.</span><span class="nx">out</span>
      <span class="nv">outPath = </span><span class="nx">pathUtil</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span><span class="nx">commanderConfig</span><span class="p">.</span><span class="nx">out</span><span class="p">)</span>
      <span class="nv">commanderConfig.outPath = </span><span class="nx">outPath</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Apply global configuration</p></div></div><div class="code"><div class="wrapper">    <span class="k">for</span> <span class="k">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">commanderConfig</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">sourceConfig</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">isnt</span> <span class="s">&#39;undefined&#39;</span>
        <span class="nx">config</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Apply custom configuration</p></div></div><div class="code"><div class="wrapper">    <span class="k">for</span> <span class="k">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">customConfig</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">sourceConfig</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">isnt</span> <span class="s">&#39;undefined&#39;</span>
        <span class="nx">config</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Return config object</p></div></div><div class="code"><div class="wrapper">    <span class="nx">config</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Select a skeleton</p></div></div><div class="code"><div class="wrapper">  <span class="nv">selectSkeletonCallback: </span><span class="nf">(skeletonsCollection,next) =&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare</p></div></div><div class="code"><div class="wrapper">    <span class="nv">commander = </span><span class="nx">@commander</span>
    <span class="nv">docpad = </span><span class="nx">@docpad</span>
    <span class="nv">locale = </span><span class="nx">docpad</span><span class="p">.</span><span class="nx">getLocale</span><span class="p">()</span>
    <span class="nv">skeletonNames = </span><span class="p">[]</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Show</p></div></div><div class="code"><div class="wrapper">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">cliColor</span><span class="p">.</span><span class="nx">bold</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">skeletonSelectionIntroduction</span><span class="o">+</span><span class="s">&#39;\n&#39;</span>
    <span class="nx">skeletonsCollection</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(skeletonModel) -&gt;</span>
      <span class="nv">skeletonName = </span><span class="nx">skeletonModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
      <span class="nv">skeletonDescription = </span><span class="nx">skeletonModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s">&#39;\n\t&#39;</span><span class="p">)</span>
      <span class="nx">skeletonNames</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">skeletonName</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        \t</span><span class="si">#{</span><span class="nx">cliColor</span><span class="p">.</span><span class="nx">bold</span><span class="p">(</span><span class="nx">skeletonName</span><span class="p">)</span><span class="si">}</span><span class="s"></span>
<span class="s">        \t</span><span class="si">#{</span><span class="nx">skeletonDescription</span><span class="si">}</span><span class="s"></span>

<span class="s">        &quot;&quot;&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Select</p></div></div><div class="code"><div class="wrapper">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">cliColor</span><span class="p">.</span><span class="nx">bold</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">skeletonSelectionPrompt</span>
    <span class="nx">commander</span><span class="p">.</span><span class="nx">choose</span> <span class="nx">skeletonNames</span><span class="p">,</span> <span class="nf">(i) -&gt;</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">skeletonsCollection</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Chain</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Welcome Callback</p></div></div><div class="code"><div class="wrapper">  <span class="nv">welcomeCallback: </span><span class="nf">(opts,next) =&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Reuqires</p></div></div><div class="code"><div class="wrapper">    <span class="nv">balUtil = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;bal-util&#39;</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare</p></div></div><div class="code"><div class="wrapper">    <span class="nv">consoleInterface = </span><span class="nx">@</span>
    <span class="nv">commander = </span><span class="nx">@commander</span>
    <span class="nv">docpad = </span><span class="nx">@docpad</span>
    <span class="nv">locale = </span><span class="nx">docpad</span><span class="p">.</span><span class="nx">getLocale</span><span class="p">()</span>
    <span class="nv">userConfig = </span><span class="nx">docpad</span><span class="p">.</span><span class="nx">userConfig</span>
    <span class="nv">welcomeTasks = </span><span class="k">new</span> <span class="nx">balUtil</span><span class="p">.</span><span class="nx">Group</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>TOS</p></div></div><div class="code"><div class="wrapper">    <span class="nx">welcomeTasks</span><span class="p">.</span><span class="nx">push</span> <span class="nf">(complete) -&gt;</span>
      <span class="k">return</span> <span class="nx">complete</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">docpad</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">prompts</span> <span class="o">is</span> <span class="kc">false</span> <span class="o">or</span> <span class="nx">userConfig</span><span class="p">.</span><span class="nx">tos</span> <span class="o">is</span> <span class="kc">true</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Ask the user if they agree to the TOS</p></div></div><div class="code"><div class="wrapper">      <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">confirm</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">tosPrompt</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nf">(ok) -&gt;</span>  <span class="nx">docpad</span><span class="p">.</span><span class="nx">track</span> <span class="s">&#39;tos&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">ok</span><span class="p">},</span> <span class="nf">(err) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Check</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="nx">ok</span>
          <span class="nv">userConfig.tos = </span><span class="kc">true</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">tosAgree</span>
          <span class="nx">docpad</span><span class="p">.</span><span class="nx">updateUserConfig</span><span class="p">(</span><span class="nx">complete</span><span class="p">)</span>
          <span class="k">return</span>
        <span class="k">else</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">tosDisagree</span>
          <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
          <span class="k">return</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Newsletter</p></div></div><div class="code"><div class="wrapper">    <span class="nx">welcomeTasks</span><span class="p">.</span><span class="nx">push</span> <span class="nf">(complete) -&gt;</span>
      <span class="k">return</span> <span class="nx">complete</span><span class="p">()</span>  <span class="k">if</span> <span class="nx">docpad</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">prompts</span> <span class="o">is</span> <span class="kc">false</span> <span class="o">or</span> <span class="nx">userConfig</span><span class="p">.</span><span class="nx">subscribed</span><span class="o">?</span> <span class="o">or</span> <span class="p">(</span><span class="nx">userConfig</span><span class="p">.</span><span class="nx">subscribeTryAgain</span><span class="o">?</span> <span class="o">and</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">userConfig</span><span class="p">.</span><span class="nx">subscribeTryAgain</span><span class="p">)))</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Ask the user if they want to subscribe to the newsletter</p></div></div><div class="code"><div class="wrapper">      <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">confirm</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribePrompt</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nf">(ok) -&gt;</span>  <span class="nx">docpad</span><span class="p">.</span><span class="nx">track</span> <span class="s">&#39;subscribe&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">ok</span><span class="p">},</span> <span class="nf">(err) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>If they don't want to, that's okay</p></div></div><div class="code"><div class="wrapper">        <span class="k">unless</span> <span class="nx">ok</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Inform the user that we received their preference</p></div></div><div class="code"><div class="wrapper">          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeIgnore</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Save their preference in the user configuration</p></div></div><div class="code"><div class="wrapper">          <span class="nv">userConfig.subscribed = </span><span class="kc">false</span>
          <span class="nx">docpad</span><span class="p">.</span><span class="nx">updateUserConfig</span> <span class="nf">(err) -&gt;</span>
            <span class="k">return</span> <span class="nx">complete</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">err</span>
            <span class="nx">balUtil</span><span class="p">.</span><span class="nx">wait</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span><span class="nx">complete</span><span class="p">)</span>
          <span class="k">return</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Scan configuration to speed up the process</p></div></div><div class="code"><div class="wrapper">        <span class="nv">commands = </span><span class="p">[</span>
          <span class="p">[</span><span class="s">&#39;config&#39;</span><span class="p">,</span><span class="s">&#39;--get&#39;</span><span class="p">,</span><span class="s">&#39;user.name&#39;</span><span class="p">]</span>
          <span class="p">[</span><span class="s">&#39;config&#39;</span><span class="p">,</span><span class="s">&#39;--get&#39;</span><span class="p">,</span><span class="s">&#39;user.email&#39;</span><span class="p">]</span>
          <span class="p">[</span><span class="s">&#39;config&#39;</span><span class="p">,</span><span class="s">&#39;--get&#39;</span><span class="p">,</span><span class="s">&#39;github.user&#39;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="nx">balUtil</span><span class="p">.</span><span class="nx">gitCommands</span> <span class="nx">commands</span><span class="p">,</span> <span class="nf">(err,results) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Ignore error as it just means a config value wasn't defined
return next(err)  if err</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Fetch
The or to '' is there because otherwise we will get "undefined" as a string if the value doesn't exist</p></div></div><div class="code"><div class="wrapper">          <span class="nx">userConfig</span><span class="p">.</span><span class="nx">name</span> <span class="o">or=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">results</span><span class="o">?</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">?</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">or</span> <span class="s">&#39;&#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">()</span> <span class="o">or</span> <span class="kc">null</span>
          <span class="nx">userConfig</span><span class="p">.</span><span class="nx">email</span> <span class="o">or=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">results</span><span class="o">?</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">?</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">or</span> <span class="s">&#39;&#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">()</span> <span class="o">or</span> <span class="kc">null</span>
          <span class="nx">userConfig</span><span class="p">.</span><span class="nx">username</span> <span class="o">or=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">results</span><span class="o">?</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">?</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">or</span> <span class="s">&#39;&#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">()</span> <span class="o">or</span> <span class="kc">null</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Let the user know we scanned their configuration if we got anything useful</p></div></div><div class="code"><div class="wrapper">          <span class="k">if</span> <span class="nx">userConfig</span><span class="p">.</span><span class="nx">name</span> <span class="o">or</span> <span class="nx">userConfig</span><span class="p">.</span><span class="nx">email</span> <span class="o">or</span> <span class="nx">userConfig</span><span class="p">.</span><span class="nx">username</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeConfigNotify</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Tasks</p></div></div><div class="code"><div class="wrapper">          <span class="nv">subscribeTasks = </span><span class="k">new</span> <span class="nx">balUtil</span><span class="p">.</span><span class="nx">Group</span> <span class="nf">(err) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Error?</p></div></div><div class="code"><div class="wrapper">            <span class="k">if</span> <span class="nx">err</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Inform the user</p></div></div><div class="code"><div class="wrapper">              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeError</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Save a time when we should try to subscribe again</p></div></div><div class="code"><div class="wrapper">              <span class="nv">userConfig.subscribeTryAgain = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1000</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span>  <span class="c1"># tomorrow</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Success</p></div></div><div class="code"><div class="wrapper">            <span class="k">else</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Inform the user</p></div></div><div class="code"><div class="wrapper">              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeSuccess</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Save the updated subscription status, and continue to what is next</p></div></div><div class="code"><div class="wrapper">              <span class="nv">userConfig.subscribed = </span><span class="kc">true</span>
              <span class="nv">userConfig.subscribeTryAgain = </span><span class="kc">null</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Save the new user configuration changes, and forward to the next task</p></div></div><div class="code"><div class="wrapper">            <span class="nx">docpad</span><span class="p">.</span><span class="nx">updateUserConfig</span><span class="p">(</span><span class="nx">userConfig</span><span class="p">,</span><span class="nx">complete</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Name Fallback</p></div></div><div class="code"><div class="wrapper">          <span class="nx">subscribeTasks</span><span class="p">.</span><span class="nx">push</span> <span class="nf">(complete) -&gt;</span>
            <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">prompt</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeNamePrompt</span><span class="p">,</span> <span class="nx">userConfig</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nf">(result) -&gt;</span>
              <span class="nv">userConfig.name = </span><span class="nx">result</span>
              <span class="nx">complete</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Email Fallback</p></div></div><div class="code"><div class="wrapper">          <span class="nx">subscribeTasks</span><span class="p">.</span><span class="nx">push</span> <span class="nf">(complete) -&gt;</span>
            <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">prompt</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeEmailPrompt</span><span class="p">,</span> <span class="nx">userConfig</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="nf">(result) -&gt;</span>
              <span class="nv">userConfig.email = </span><span class="nx">result</span>
              <span class="nx">complete</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Username Fallback</p></div></div><div class="code"><div class="wrapper">          <span class="nx">subscribeTasks</span><span class="p">.</span><span class="nx">push</span> <span class="nf">(complete) -&gt;</span>
            <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">prompt</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeUsernamePrompt</span><span class="p">,</span> <span class="nx">userConfig</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nf">(result) -&gt;</span>
              <span class="nv">userConfig.username = </span><span class="nx">result</span>
              <span class="nx">complete</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Save the details</p></div></div><div class="code"><div class="wrapper">          <span class="nx">subscribeTasks</span><span class="p">.</span><span class="nx">push</span> <span class="nf">(complete) -&gt;</span>
            <span class="nx">docpad</span><span class="p">.</span><span class="nx">updateUserConfig</span><span class="p">(</span><span class="nx">complete</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Perform the subscribe</p></div></div><div class="code"><div class="wrapper">          <span class="nx">subscribeTasks</span><span class="p">.</span><span class="nx">push</span> <span class="nf">(complete) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Inform the user</p></div></div><div class="code"><div class="wrapper">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeProgress</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare our connection</p></div></div><div class="code"><div class="wrapper">            <span class="nv">requestUrl = </span><span class="nx">docpad</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">helperUrl</span><span class="o">+</span><span class="s">&#39;?&#39;</span><span class="o">+</span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;querystring&#39;</span><span class="p">).</span><span class="nx">stringify</span><span class="p">(</span>
              <span class="nv">method: </span><span class="s">&#39;add-subscriber&#39;</span>
              <span class="nv">name: </span><span class="nx">userConfig</span><span class="p">.</span><span class="nx">name</span>
              <span class="nv">email: </span><span class="nx">userConfig</span><span class="p">.</span><span class="nx">email</span>
              <span class="nv">username: </span><span class="nx">userConfig</span><span class="p">.</span><span class="nx">username</span>
            <span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Innitialize our request</p></div></div><div class="code"><div class="wrapper">            <span class="nx">balUtil</span><span class="p">.</span><span class="nx">readPath</span> <span class="nx">requestUrl</span><span class="p">,</span> <span class="nf">(err,body) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Check</p></div></div><div class="code"><div class="wrapper">              <span class="k">if</span> <span class="nx">err</span>
                <span class="nx">docpad</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;debug&#39;</span><span class="p">,</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeRequestError</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span>
                <span class="k">return</span> <span class="nx">complete</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Log it to debug console</p></div></div><div class="code"><div class="wrapper">              <span class="nx">docpad</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;debug&#39;</span><span class="p">,</span> <span class="nx">locale</span><span class="p">.</span><span class="nx">subscribeRequestData</span><span class="p">,</span> <span class="nx">body</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Inform the user know of the success or not</p></div></div><div class="code"><div class="wrapper">              <span class="k">try</span>
                <span class="nv">data = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">success</span> <span class="o">is</span> <span class="kc">false</span>
                  <span class="nx">complete</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">error</span> <span class="o">or</span> <span class="s">&#39;unknown error&#39;</span><span class="p">))</span>
                <span class="k">else</span>
                  <span class="nx">complete</span><span class="p">()</span>
              <span class="k">catch</span> <span class="nx">err</span>
                <span class="nx">complete</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Run</p></div></div><div class="code"><div class="wrapper">          <span class="nx">subscribeTasks</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Run</p></div></div><div class="code"><div class="wrapper">    <span class="nx">welcomeTasks</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Chain</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prompt for input</p></div></div><div class="code"><div class="wrapper">  <span class="nv">prompt: </span><span class="nf">(message,fallback,next) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare</p></div></div><div class="code"><div class="wrapper">    <span class="nv">consoleInterface = </span><span class="nx">@</span>
    <span class="nv">commander = </span><span class="nx">@commander</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Fallback</p></div></div><div class="code"><div class="wrapper">    <span class="nx">message</span> <span class="o">+=</span> <span class="s">&quot; [</span><span class="si">#{</span><span class="nx">fallback</span><span class="si">}</span><span class="s">]&quot;</span>  <span class="k">if</span> <span class="nx">fallback</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Log</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span><span class="p">.</span><span class="nx">prompt</span> <span class="nx">message</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nf">(result) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Parse</p></div></div><div class="code"><div class="wrapper">      <span class="k">unless</span> <span class="nx">result</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="c1"># no value</span>
        <span class="k">if</span> <span class="nx">fallback</span><span class="o">?</span> <span class="c1"># has default value</span>
          <span class="nv">result = </span><span class="nx">fallback</span> <span class="c1"># set to default value</span>
        <span class="k">else</span> <span class="c1"># otherwise try again</span>
          <span class="k">return</span> <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">prompt</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="nx">fallback</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Forward</p></div></div><div class="code"><div class="wrapper">      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Chain</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Confirm an option</p></div></div><div class="code"><div class="wrapper">  <span class="nv">confirm: </span><span class="nf">(message,fallback,next) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare</p></div></div><div class="code"><div class="wrapper">    <span class="nv">consoleInterface = </span><span class="nx">@</span>
    <span class="nv">commander = </span><span class="nx">@commander</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Fallback</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="nx">fallback</span> <span class="o">is</span> <span class="kc">true</span>
      <span class="nx">message</span> <span class="o">+=</span> <span class="s">&quot; [Y/n]&quot;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">fallback</span> <span class="o">is</span> <span class="kc">false</span>
      <span class="nx">message</span> <span class="o">+=</span> <span class="s">&quot; [y/N]&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Log</p></div></div><div class="code"><div class="wrapper">    <span class="nx">commander</span><span class="p">.</span><span class="nx">prompt</span> <span class="nx">message</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nf">(ok) -&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Parse</p></div></div><div class="code"><div class="wrapper">      <span class="k">unless</span> <span class="nx">ok</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="c1"># no value</span>
        <span class="k">if</span> <span class="nx">fallback</span><span class="o">?</span> <span class="c1"># has default value</span>
          <span class="nv">ok = </span><span class="nx">fallback</span> <span class="c1"># set to default value</span>
        <span class="k">else</span> <span class="c1"># otherwise try again</span>
          <span class="k">return</span> <span class="nx">consoleInterface</span><span class="p">.</span><span class="nx">confirm</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="nx">fallback</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>
      <span class="k">else</span> <span class="c1"># parse the value</span>
        <span class="nv">ok = </span><span class="sr">/^y|yes|ok|true$/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ok</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Forward</p></div></div><div class="code"><div class="wrapper">      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">ok</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Chain</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>=================================
Actions</p></div></div><div class="code"><div class="wrapper">  <span class="nv">generate: </span><span class="nf">(next) =&gt;</span>
    <span class="nx">@docpad</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s">&#39;generate&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>
    <span class="nx">@</span>

  <span class="nv">help: </span><span class="nf">(next) =&gt;</span>
    <span class="nv">help = </span><span class="nx">@commander</span><span class="p">.</span><span class="nx">helpInformation</span><span class="p">()</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">help</span><span class="p">)</span>
    <span class="nx">next</span><span class="p">()</span>
    <span class="nx">@</span>

  <span class="nv">info: </span><span class="nf">(next) =&gt;</span>
    <span class="nv">info = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;util&#39;</span><span class="p">).</span><span class="nx">inspect</span><span class="p">(</span><span class="nx">@docpad</span><span class="p">.</span><span class="nx">config</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">info</span><span class="p">)</span>
    <span class="nx">next</span><span class="p">()</span>
    <span class="nx">@</span>

  <span class="nv">install: </span><span class="nf">(next) =&gt;</span>
    <span class="nx">@docpad</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s">&#39;install&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>
    <span class="nx">@</span>

  <span class="nv">render: </span><span class="nf">(next) =&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare</p></div></div><div class="code"><div class="wrapper">    <span class="nv">docpad = </span><span class="nx">@docpad</span>
    <span class="nv">commander = </span><span class="nx">@commander</span>
    <span class="nv">balUtil = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;bal-util&#39;</span><span class="p">)</span>
    <span class="nv">opts = </span><span class="p">{}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare filename</p></div></div><div class="code"><div class="wrapper">    <span class="nv">filename = </span><span class="nx">commander</span><span class="p">.</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">or</span> <span class="kc">null</span>
    <span class="nv">basename = </span><span class="nx">pathUtil</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
    <span class="nv">opts.filename = </span><span class="nx">filename</span>
    <span class="nv">opts.renderSingleExtensions = </span><span class="s">&#39;auto&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Prepare text</p></div></div><div class="code"><div class="wrapper">    <span class="nv">data = </span><span class="s">&#39;&#39;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Render</p></div></div><div class="code"><div class="wrapper">    <span class="nv">useStdin = </span><span class="kc">true</span>
    <span class="nv">renderDocument = </span><span class="nf">-&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Perform the render</p></div></div><div class="code"><div class="wrapper">      <span class="nx">docpad</span><span class="p">.</span><span class="nx">action</span> <span class="s">&#39;render&#39;</span><span class="p">,</span> <span class="nx">opts</span><span class="p">,</span> <span class="nf">(err,result) -&gt;</span>
        <span class="k">return</span> <span class="nx">docpad</span><span class="p">.</span><span class="nx">fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">err</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Path</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="nx">commander</span><span class="p">.</span><span class="nx">out</span><span class="o">?</span>
          <span class="nx">balUtil</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">commander</span><span class="p">.</span><span class="nx">out</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Stdout</p></div></div><div class="code"><div class="wrapper">        <span class="k">else</span>
          <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
          <span class="nx">next</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Timeout if we don't have stdin</p></div></div><div class="code"><div class="wrapper">    <span class="nv">timeout = </span><span class="nx">setTimeout</span><span class="p">(</span>
      <span class="nf">-&gt;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Clear timeout</p></div></div><div class="code"><div class="wrapper">        <span class="nv">timeout = </span><span class="kc">null</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Skip if we are using stdin</p></div></div><div class="code"><div class="wrapper">        <span class="k">return</span>  <span class="k">if</span> <span class="nx">data</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Close stdin as we are not using it</p></div></div><div class="code"><div class="wrapper">        <span class="nv">useStdin = </span><span class="kc">false</span>
        <span class="nx">stdin</span><span class="p">.</span><span class="nx">pause</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Render the document</p></div></div><div class="code"><div class="wrapper">        <span class="nx">renderDocument</span><span class="p">()</span>
      <span class="p">,</span><span class="mi">1000</span>
    <span class="p">)</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Read stdin</p></div></div><div class="code"><div class="wrapper">    <span class="nv">stdin = </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span>
    <span class="nx">stdin</span><span class="p">.</span><span class="nx">resume</span><span class="p">()</span>
    <span class="nx">stdin</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>
    <span class="nx">stdin</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="nf">(_data) -&gt;</span>
      <span class="nx">data</span> <span class="o">+=</span> <span class="nx">_data</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
      <span class="k">return</span>  <span class="k">unless</span> <span class="nx">useStdin</span>
      <span class="k">if</span> <span class="nx">timeout</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">)</span>
        <span class="nv">timeout = </span><span class="kc">null</span>
      <span class="nv">opts.data = </span><span class="nx">data</span>
      <span class="nx">renderDocument</span><span class="p">()</span>

    <span class="nx">@</span>

  <span class="nv">run: </span><span class="nf">(next) =&gt;</span>
    <span class="nx">@docpad</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span>
      <span class="s">&#39;run&#39;</span>
      <span class="p">{</span><span class="nv">selectSkeletonCallback: </span><span class="nx">@selectSkeletonCallback</span><span class="p">}</span>
      <span class="nx">next</span>
    <span class="p">)</span>
    <span class="nx">@</span>

  <span class="nv">server: </span><span class="nf">(next) =&gt;</span>
    <span class="nx">@docpad</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s">&#39;server generate&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>
    <span class="nx">@</span>

  <span class="nv">clean: </span><span class="nf">(next) =&gt;</span>
    <span class="nx">@docpad</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s">&#39;clean&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>
    <span class="nx">@</span>

  <span class="nv">skeleton: </span><span class="nf">(next) =&gt;</span>
    <span class="nx">@docpad</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span>
      <span class="s">&#39;skeleton&#39;</span>
      <span class="p">{</span><span class="nv">selectSkeletonCallback: </span><span class="nx">@selectSkeletonCallback</span><span class="p">}</span>
      <span class="nx">next</span>
    <span class="p">)</span>
    <span class="nx">@</span>

  <span class="nv">watch: </span><span class="nf">(next) =&gt;</span>
    <span class="nx">@docpad</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s">&#39;generate watch&#39;</span><span class="p">,</span><span class="nx">next</span><span class="p">)</span>
    <span class="nx">@</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>=================================
Export</p></div></div><div class="code"><div class="wrapper"><span class="nv">module.exports = </span><span class="nx">ConsoleInterface</span></div></div></div></div></body></html>